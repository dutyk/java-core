# 介绍
加密货币和数字区块链资产市场已发展成为一个充满活力的由投资者、投机者和交易者的生态系统，交换了成千上万的区块链资产。不幸的是，金融市场的复杂性并没有随之而来：参与者几乎没有交易资产时间价值的能力。

利率填补了拥有多余的无法使用的资产的人与没有资产的人们之间的差距。资产(具有生产或投资用途)；交易资产的时间价值对双方都有利并创造非零财富。对于区块链资产，当今存在两个主要缺陷：
- 借入机制极为有限，这会导致资产定价错误(例如，具有无法估量的"骗局"，因为没有办法将其卖空)。
- 区块链资产的负收益是由于巨大的存储成本和风险(在交易或者不在交易)，而没有自然利率来抵消这些费用。这个持股被取消激励，导致波动。
  
中心化交易所(包括Bitfinex，Poloniex ...)允许客户交易区块链资产，在交易所中内置了"借贷市场"。这些是基于信任的系统(您必须相信交易所不会被黑客入侵，潜入您的资产或错误地关闭您的寸头)，仅限于某些客群，并且仅限于少数(最主流)资产。最后，余额和头寸是虚拟的；您无法在链上移动寸头，例如在智能合约或ICO中使用借来的以太币或代币，从而使得dApp无法访问这些设施[2]。

点对点协议促进了市场参与者之间的抵押贷款和无抵押贷款。不幸的是，权力下放迫使大量成本和摩擦用户；在每个经过审查的协议中，借款方都必须发布，管理和(抵押贷款情况)监督贷款报价和有效贷款，贷款履行通常很慢、异步(贷款需要资金，这需要时间)[3-6]。

在本文，我们介绍了去中心化的以太坊无抵押借贷系统，没有现有方法的缺陷，可以使适当的货币市场功能，并且创建安全的正收益性资产存储方法。

# Compound 协议

复合是在以太坊区块链上建立的协议，建立货币市场，它是基于资产供求关系的资金池，通过算法得出利率。资产的供应商(和借款人)直接与协议交互，获得(和支付)浮动收益利率，而无需协商期限、利率、与同行或交易对手的抵押品。

每个货币市场对于以太坊资产(例如以太币，ERC-20稳定币例如Dai，或ERC-20实用token(例如Augur))是唯一的，并包含透明且可公开检查的
账户，其中包含所有交易和历史利率的记录。

## 供应资产

与交易或点对点平台不同，在该平台上，用户的资产被匹配并借给另一个用户，Compound协议聚合每个用户的供应；当用户提供资产时，它成为可替代的资源。这种方法比直接贷款提供了更多的流动性。除非借用市场中的每项资产(请参见下文：协议激励流动性)，否则用户可以随时提取资产，而无需等待特定贷款到期。

供应给市场的资产由ERC-20代币余额("cToken")表示，所有者增加基础资产的数量。随着货币市场产生利息，这是借贷需求的函数，cToken可转换为越来越多的基础资产数量。这样，赚取利息就像持有ERC-20 cToken一样简单。

### 主要用例
对以太币和代币("HODLers")有长期投资的个人可以使用货币市场作为其投资额外收益的来源。例如，拥有Augur可以将其token提供给Compound协议，并赚取利息(以Augur计算)，而无需管理其资产，履行贷款要求或承担投机风险。

dApps，机器和具有代币余额的交易所可以使用Compound协议作为，来通过"清算"余额货币化和增加收益；这有可能解锁以太坊生态系统的全新商业模式。

## 借入资产
Compound协议允许用户使用cTokens作为抵押品，毫不费力地从协议中借钱，在以太坊生态系统中的任何地方使用。与点对点协议不同，从
Compound协议借款，仅要求用户指定所需资产；没有谈判协商，到期日或融资周期；借款是即时且可预测的。类似于提供一个资产，每个货币市场都由市场力量设定浮动利率，这决定了每项资产的借贷成本。

### 抵押品价值
协议持有的资产(以cToken的所有权表示)用作抵押品，从协议借款。每个市场都有一个从0到1的抵押因子，代表了可借入的基础资产价值的百分比。流动性差，小盘资产的抵押因子较小;他们不是很好的抵押品，而流动性好、高价值的资产有很高的抵押因子。代币余额基础上的账户价值总和乘以抵押因子，等于用户的借贷额度。

用户最多可以借用但不能超过其借贷额度，并且帐户的任何行动不会(例如借款，存入cToken抵押品或赎回cToken抵押品)使借入资产的总价值超过其借贷能力；这保护了协议违约风险。

### 风险与清算
如果帐户的未偿还借贷价值超过其借贷能力，则其中一部分未偿还的借贷可通过以下方式偿还，以当前市场价格减去清算折扣换取用户的cToken抵押品;这激励了生态系统的套利者快速介入以减少借款人的风险，并消除协议的风险。

这个比例，(一个close因子)是借款资产中可以偿还的比例，范围为0到1，例如25％。清算程序可能会继续被调用直到用户的借贷少于他们的借贷能力。

任何拥处理借款资产的以太坊地址都可以调用清算功能，将其资产和借款人的cToken抵押品做交换。两个用户、资产和价格都包含在Compound协议中，清算是无摩擦的并且不依赖于任何外部系统或订单。

### 主要用例
无缝持有新资产的能力(无需出售或重新安排投资组合)可带来新的dApp消费者，交易者和开发者：
- dApps无需等待订单完成或需要链下行为，就可以借用代币，在以太坊生态系统中使用，例如购买计算能力
- 交易者可以使用现有的资产做抵押，借入的以太币来筹集新的ICO投资
- 希望做空令牌的交易者可以借入令牌，将其发送到交易所并出售令牌，从高估代币的价格下跌中获利

## 利率模型
无需单个供应商或借款人就条款和利率进行谈判，Compound协议利用利率模型来实现利率均衡，即每个货币市场，基于供求关系。根据经济学理论，利率(货币的"价格")应随需求而增加；当需求低时，利率应该低，反之亦然。每个市场a的利用率表示为U，将供需统一为一个变量：

U(a) = Borrows(a) /(Cash(a) + Borrows(a))

需求曲线通过治理进行整理，并表示为利用率的函数。例如，借入利率可能类似于以下内容：

Borrowing Interest Ratea(a) = 2.5％ + U(a) * 20％

供应商赚取的利率是隐含的，等于Borrowing Interest Ratea(a)乘以利用率。


### 流动性激励结构
该协议不保证流动性。相反，它依靠利率模型来激励它。在对资产的极端需求时期，协议的流动性(tokens可用于存入或借出)将下降；当这种情况发生时，利率上升，激励了供应，并且抑制借贷。

# 实施与架构
Compound货币市场的核心是一个账户，允许以太坊账户提供资产或借款，在计算利息时，是时间的函数。该协议的智能合约可公开访问，并且完全免费供机器，dApp和人类使用。

## cToken合约
每个货币市场的结构都实现ERC-20代币的智能合约规范。用户的余额表示为cToken余额；用户可以mint(uint
amountUnderlying)cTokens，向市场供应资产，redeem(uint amount)cTokens, 赎回基础资产。 cToken与基础资产之间的价格(汇率)随时间增加，因为资产的借款人的利息是累计的，等于：

exchangeRate = underlyingBalance + totalBorrowBalance(a) − reserves(a) / cTokenSupply(a)

随着市场总借贷余额的增加(借贷者累计利息的函数)，cToken与基础资产之间的汇率上升。

函数 | 描述
- | :- |
mint(uint256 amountUnderlying) | 将基础资产转移到市场，更新msg.sender的cToken余额。|  
redeem(uint256 amount) redeemUnderlying(uint256 amountUnderlying) | 将基础资产移出市场，进行更新msg.sender的cToken余额。|
borrow(uint amount) | 检查msg.sender抵押品值，如果足够，将基础资产从市场转移给msg.sender，并更新msg.sender的借款余额。 |
repayBorrow(uint amount)
repayBorrowBehalf(address account, uint amount) | 将基础资产转移到市场，更新借款人的借款余额。 |
liquidate(address borrower,address collateralAsset, uint closeAmount) | 将基础资产转移到市场，更新借款人的借款余额，然后从借款人向msg.sender转移cToken抵押物 |

## 利率机制
复合货币市场由利率定义，统一适用于所有借款人，
随着供应和需求之间关系的变化，它会随着时间而调整。
对于每个货币市场，每个利率的历史记录都由一个利率指数捕获，该指数
每次由用户铸造，赎回，
借入，偿还或清算资产。
3.2.1市场动态
每次发生交易时，资产的利率指数都会更新以使
自先前指数以来的利息，使用该期间的利息(以r * t表示)计算
使用每块利率：
Indexa，n = Indexa，(n-1)*(1 + r * t)
市场的未偿还借贷总额已更新为包括自上一个指数以来的应计利息：
totalBorrowBalancea，n = totalBorrowBalance a，(n-1)*(1 + r * t)
一部分应计利息被保留(预留)为准备金，具体取决于
reserveFactor，范围从0到1：
reservea =储备a，(n-1)+ totalBorrowBalancea，(n-1)*(r * t * reserveFactor)
3.2.2借款人动态
借款人的余额(包括应计利息)就是当前指数除以
最后一次检查用户余额时的索引。

到那个帐户。
3.3借款
希望借款且在大院中有足够余额的用户可以致电
在相关cToken合约上借入(单位金额)。此函数调用检查用户的帐户
价值，并有足够的抵押品，将更新用户的借入余额，将代币转移到
用户的以太坊地址，并更新货币市场的浮动利率。
借款的应计利息与第3.2节中计算的余额利息完全相同；一个
借款人有权随时通过致电repayBorrow(uint
金额)以偿还未结余额。
3.4清算
如果由于以下原因，用户的借款余额超过其抵押品总价值(借款能力)
抵押品价值下降或借入资产价值增加，公共职能
清算(地址目标，地址抵押资产，地址借款资产，uint
closeAmount)可以调用，它将调用用户的资产交换为借款人的抵押品，
价格略高于市场价格。
3.5价格提要
Price Oracle维护每种支持资产的当前汇率；复合协议
将权衡资产价值的能力委托给一个委员会，该委员会从前十名中汇总价格
交流。这些汇率用于确定借贷能力和抵押品
要求，以及需要计算帐户价值等值的所有功能。
3.6主计长
默认情况下，Compound协议不支持特定令牌。相反，市场必须
白名单。这是通过管理功能supportMarket(地址市场，
地址利率模型)，该模型允许用户开始与资产进行互动。为了
借用资产时，必须有来自价格Oracle的有效价格；为了将资产用作
抵押，必须有一个有效的价格和一个抵押因子。
每个函数调用均通过称为Comptroller的策略层进行验证。这个合同
在允许用户执行操作之前，先验证抵押品和流动性。

3.7治理
复合将从协议的集中控制开始(例如选择利率
资产模型)，随着时间的推移，将过渡到完整的社区和利益相关者控制。
协议中的以下权限由管理员控制：
●能够列出新的cToken市场
●能够更新每个市场的利率模型
●能够更新Oracle地址
●提取cToken储备金的能力
●能够选择新管理员，例如由社区控制的DAO；因为
这个DAO本身可以选择一个新的管理员，该管理员可以继续
时间，基于利益相关者的决定
4小结
●复合货币为以太坊资产创造功能正常的货币市场
●每个货币市场的利率都取决于货币市场的供求关系。
标的资产；当借用资产的需求增加或供应中断时，
利率上升，刺激了额外的流动性
●用户无需信任中央机构就可以向货币市场提供代币以赚取利息
●用户可以通过使用协议中的余额来借用令牌(使用，出售或再借出)
